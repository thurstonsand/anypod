run all lints and tests and address issues.

- `uv run pre-commit --all-files` and address issues
- `uv run pytest --integration` and address failing tests